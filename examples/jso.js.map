{"version":3,"sources":["webpack://jso/webpack/universalModuleDefinition","webpack://jso/./src/Config.js","webpack://jso/./src/EventEmitter.js","webpack://jso/./src/HTTP/Fetcher.js","webpack://jso/./src/HTTP/FetcherJQuery.js","webpack://jso/./src/Loaders/BasicLoader.js","webpack://jso/./src/Loaders/HTTPRedirect.js","webpack://jso/./src/Loaders/IFrameActive.js","webpack://jso/./src/Loaders/IFramePassive.js","webpack://jso/./src/Loaders/Popup.js","webpack://jso/./src/errors/Error.js","webpack://jso/./src/errors/ExpiredTokenError.js","webpack://jso/./src/errors/OAuthResponseError.js","webpack://jso/./src/store-session.js","webpack://jso/./src/utils.js","webpack://jso/webpack/bootstrap","webpack://jso/webpack/runtime/define property getters","webpack://jso/webpack/runtime/hasOwnProperty shorthand","webpack://jso/webpack/runtime/make namespace object","webpack://jso/./src/JSO.js"],"names":["Config","config","i","arguments","length","Object","assign","token","use_pkce","key","pointer","splittedKeys","split","hasOwnProperty","defaultValue","isRequired","undefined","Error","EventEmitter","type","callback","_callbacks","push","args","Array","prototype","slice","call","apply","Fetcher","jso","url","opts","fetch","then","response","status","ExpiredTokenError","reccur","getTokenOpts","fetchOpts","getToken","catch","err","console","error","headers","Authorization","access_token","_fetch","wipeTokens","FetcherJQuery","jquery","Promise","resolve","reject","done","fail","jqXHR","textStatus","errorThrown","parseInt","ajax","BasicLoader","log","HTTPRedirect","window","location","IFrameActive","theIframe","document","getElementById","doIframeLoad","oWin","contentWindow","postMessage","origin","e","addEventListener","messageReceiver","event","data","toString","indexOf","setAttribute","focus","IFramePassive","timeout","isCompleted","id","utils","eventMethod","eventer","messageEvent","iframe","createElement","object","hash","encodedHash","substring","search","_completed","_failed","errorCallback","getElementsByTagName","appendChild","setTimeout","element","parentNode","removeChild","_cleanup","Popup","popupCompleted","newwindow","href","w","h","left","screen","width","top","height","open","props","value","OAuthResponseError","header","descr","error_description","Store","state","obj","sessionStorage","setItem","JSON","stringify","parse","getItem","removeItem","scope","scopes","tokens","j","result","now","usethis","expires","hasScope","provider","getTokens","filterTokens","saveTokens","s","epoch","Math","round","Date","getTime","debug","uuid","replace","c","r","random","v","getResponseFromURL","parseQueryString","qs","a","d","decodeURIComponent","q","urlParams","exec","scopeList","uniqueList","join","items","uniqueItems","resultItems","msg","unshift","encodeQS","params","res","k","encodeURIComponent","encodeURL","firstSeparator","sha256Hash","str","crypto","subtle","digest","TextEncoder","encode","encode64","buff","btoa","Uint8Array","reduce","b","String","fromCharCode","base64UrlSafeEncode","buf","getCodeChallenge","code_verifier","hashed","finally","package_json","require","default_config","lifetime","response_type","JSO","configure","connector_name","getconnector_name","Loader","store","callbacks","getValue","newstore","loader","client_id","authorization","atoken","getState","processReceivedToken","received","expires_in","has","saveToken","signal","CustomEvent","bubbles","detail","dispatchEvent","Headers","append","tokenRequest","code","redirect_uri","mode","method","body","httpResponse","json","tokenResponse","restoreHash","processTokenResponse","processAuthorizationCodeResponse","processErrorResponse","x","request","authurl","bUsePKCE","saveState","gotoAuthorizeURL","openid","includes","nonce","cv","getRandomValues","cc","code_challenge","code_challenge_method","_authorize2","execute"],"mappings":"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","file":"jso.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"jso\"] = factory();\n\telse\n\t\troot[\"jso\"] = factory();\n})(self, function() {\nreturn ","export default class Config {\n\n\tconstructor() {\n\t\tthis.config = {}\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tObject.assign(this.config, arguments[i]);\n\t\t}\n\n\t\t// enable pkce when token endpoint is provided\n\t\tif(this.config.token) this.config.use_pkce = true;\n\t}\n\n\thas(key) {\n\t\tvar pointer = this.config\n\t\tvar splittedKeys = key.split('.')\n\t\tvar i = 0\n\t\tfor (i = 0; i < splittedKeys.length; i++) {\n\t\t\tif (pointer.hasOwnProperty(splittedKeys[i])) {\n\t\t\t\tpointer = pointer[splittedKeys[i]]\n\t\t\t} else {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t\treturn true\n\t}\n\n\tgetValue(key, defaultValue, isRequired) {\n\t\tvar isRequired = isRequired || false\n\t\tvar pointer = this.config\n\t\tvar splittedKeys = key.split('.')\n\t\tvar i = 0\n\t\tfor (i = 0; i < splittedKeys.length; i++) {\n\n\t\t\tif (pointer.hasOwnProperty(splittedKeys[i])) {\n\t\t\t\t// console.log(\"POINTING TO \" + splittedKeys[i]);\n\t\t\t\tpointer = pointer[splittedKeys[i]]\n\t\t\t} else {\n\t\t\t\tpointer = undefined\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tif (typeof pointer === 'undefined') {\n\t\t\tif (isRequired) {\n\t\t\t\tthrow new Error(\"Configuration option [\" + splittedKeys[i] + \"] required but not provided.\")\n\t\t\t}\n\t\t\treturn defaultValue\n\t\t}\n\t\treturn pointer\n\t}\n}\n","export default class EventEmitter {\n\n  on(type, callback) {\n    if (!this._callbacks) {\n      this._callbacks = {}\n    }\n    if (!this._callbacks[type]) {\n      this._callbacks[type] = []\n    }\n\n    this._callbacks[type].push(callback)\n  }\n\n  emit(type) {\n    if (!this._callbacks) {\n      this._callbacks = {}\n    }\n    if (!this._callbacks[type]) {\n      this._callbacks[type] = []\n    }\n\n    var args = Array.prototype.slice.call(arguments, 1)\n    for(var i = 0; i < this._callbacks[type].length; i++) {\n      this._callbacks[type][i].apply(this, args)\n    }\n  }\n}\n","\nimport ExpiredTokenError from '../errors/ExpiredTokenError'\n\nexport default class Fetcher {\n\tconstructor(jso) {\n    this.jso = jso\n\t}\n\n  _fetch(url, opts) {\n    return fetch(url, opts)\n      .then((response) => {\n        if (response.status === 401) {\n          throw new ExpiredTokenError()\n        }\n        return response\n      })\n  }\n\n\tfetch(url, opts, reccur) {\n    reccur = reccur ? reccur : 0\n    if (reccur > 2) {\n      throw new Error(\"Reccursion error. Expired tokens deleted and tried again multiple times.\")\n    }\n    let getTokenOpts = {}\n    let fetchOpts = {\n      'mode': 'cors'\n    }\n    if (opts) {\n      fetchOpts = opts\n      Object.assign(fetchOpts, opts)\n    }\n    if (opts && opts.jso) {\n      Object.assign(getTokenOpts, opts.jso)\n    }\n\n    return this.jso.getToken(getTokenOpts)\n      .catch((err) => {\n        console.error(\"Error fetching token to use \", err)\n      })\n      .then((token) => {\n      \t// console.log(\"I got the token: \", token.access_token)\n\n        if (!fetchOpts.headers) {\n          fetchOpts.headers = {}\n        }\n        fetchOpts.headers.Authorization = 'Bearer ' + token.access_token\n        return this._fetch(url, fetchOpts)\n          .catch((err) => {\n            if (err instanceof ExpiredTokenError) {\n              console.error(\"Token was expired. Deleting all tokens for this provider and get a new one\", err)\n              this.jso.wipeTokens()\n              return this.fetch(url, opts, reccur+1)\n            }\n          })\n\n      })\n\t}\n\n\n\n}\n","import ExpiredTokenError from '../errors/ExpiredTokenError'\n\nexport default class FetcherJQuery {\n\tconstructor(jso, jquery) {\n    this.jso = jso\n    this.jquery = jquery\n\t}\n\n  _fetch(url, opts) {\n\n    return new Promise((resolve, reject) => {\n\n      opts.done = resolve\n      opts.fail = (jqXHR, textStatus, errorThrown) => {\n        let status = parseInt(textStatus, 10)\n        if (status === 401) {\n          this.jso.wipeTokens()\n          return reject(new ExpiredTokenError())\n        }\n        return reject(errorThrown)\n      }\n      return this.jquery.ajax(url, opts)\n\n    })\n\n  }\n\n\tfetch(url, opts, reccur) {\n    reccur = reccur ? reccur : 0\n    if (reccur > 2) {\n      throw new Error(\"Reccursion error. Expired tokens deleted and tried again multiple times.\")\n    }\n    let getTokenOpts = {}\n    let fetchOpts = {\n      'mode': 'cors'\n    }\n    if (opts) {\n      fetchOpts = opts\n      Object.assign(fetchOpts, opts)\n    }\n    if (opts && opts.jso) {\n      Object.assign(getTokenOpts, opts.jso)\n    }\n\n    return this.jso.getToken(getTokenOpts)\n      .catch((err) => {\n        console.error(\"Error fetching token to use \", err)\n      })\n      .then((token) => {\n      \t// console.log(\"I got the token: \", token.access_token)\n\n        if (!fetchOpts.headers) {\n          fetchOpts.headers = {}\n        }\n        fetchOpts.headers.Authorization = 'Bearer ' + token.access_token\n        return this._fetch(url, fetchOpts)\n          .catch((err) => {\n            if (err instanceof ExpiredTokenError) {\n              console.error(\"Token was expired. Deleting all tokens for this provider and get a new one\", err)\n              this.jso.wipeTokens()\n              return this.fetch(url, opts, reccur+1)\n            }\n          })\n\n      })\n\t}\n\n\n\n}\n","export default class BasicLoader {\n\tconstructor(url) {\n\t\tconsole.log(\"Initializing a loader with url \" + url)\n\t\tthis.url = url\n\t}\n\texecute() {\n\n\t}\n}\n","import BasicLoader from './BasicLoader'\nimport utils from '../utils'\n\nexport default class HTTPRedirect extends BasicLoader {\n\texecute() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\twindow.location = this.url\n\t\t})\n\t}\n}\n","import BasicLoader from './BasicLoader'\nimport utils from '../utils'\n\nexport default class IFrameActive extends BasicLoader {\n\n  execute() {\n\n\t  return new Promise((resolve, reject) => {\n\n      /*\n      // Create IE + others compatible event handler\n      var eventMethod = window.addEventListener ? \"addEventListener\" : \"attachEvent\"\n      var eventer = window[eventMethod]\n      var messageEvent = eventMethod == \"attachEvent\" ? \"onmessage\" : \"message\"\n      */\n\n      // Using a specific expected name for now.  Would be better if the loader constructor also passed in\n      //  \"opts\" structure, so each loader might add specific initialization properties necessary fo the\n      //  particular loader\n      let theIframe = document.getElementById(\"jsoActiveIframe\");\n\n      function doIframeLoad() {\n        let oWin = theIframe.contentWindow;\n\n          // When page is loaded try to post a message to it to get back the message\n          try {\n            theIframe.contentWindow.postMessage(\"JSO\", window.location.origin);\n          } catch (e) {\n            // do nothing if this window is from a different domain and it fails\n          }\n          // In case we need to send a post message to the loaded iframe window before it\n          // can send us a message\n      }\n\n      theIframe.addEventListener(\"load\", doIframeLoad, true);\n\n\n      let messageReceiver = (event) => {\n        // Check origin\n        if( event.origin != location.origin)\n          return;\n        var url = event.data.toString();\n        if( -1 != url.indexOf(\"?code=\") ) {\n          resolve(url);\n        }\n      };\n\n      // Setup call back function to receive postMessage from page loaded in iframe\n      window.addEventListener(\"message\", messageReceiver, false);\n \n      theIframe.setAttribute(\"src\", this.url);\n\n\n\t\t\tif (window.focus) {\n        if( theIframe.contentWindow ) {\n          theIframe.contentWindow.focus()\n        }\n\t\t\t}\n\n\t\t})\n\t}\n}\n","import BasicLoader from './BasicLoader'\nimport utils from '../utils'\n\nexport default class IFramePassive extends BasicLoader {\n\n\tconstructor(url) {\n\t\tsuper(url)\n\n\t\tthis.timeout = 5000\n\t\tthis.callback = null\n\t\tthis.isCompleted = false\n    this.id = 'jso_passive_iframe_' + utils.uuid()\n\n    // Create IE + others compatible event handler\n    var eventMethod = window.addEventListener ? \"addEventListener\" : \"attachEvent\"\n    var eventer = window[eventMethod]\n    var messageEvent = eventMethod == \"attachEvent\" ? \"onmessage\" : \"message\"\n\n    this.iframe = document.createElement('iframe')\n    this.iframe.setAttribute('id', this.id)\n    this.iframe.setAttribute('src', url)\n\n    this.iframe.addEventListener('load', (e) => {\n\n      let object = null\n      try {\n        if (this.iframe.contentWindow.location.hash) {\n          let encodedHash = this.iframe.contentWindow.location.hash.substring(1)\n          object = utils.parseQueryString(encodedHash)\n        } else if (this.iframe.contentWindow.location.search) {\n          let encodedHash = this.iframe.contentWindow.location.search.substring(1)\n          object = utils.parseQueryString(encodedHash)\n        }\n\n        if (object !== null) {\n          this._completed(object)\n        } else {\n          this._failed(new Error(\"Failed to obtain response value from iframe\"))\n        }\n      } catch(err) {\n        // Most likely not able to access the content window because of same-origin policy.\n        //\n        // Ignore this error, as this is likely to happen during the SSO redirect loop, but the load\n        // event may be triggered multiple times, so it is not neccessary a problem that the first is not\n        // accessible.\n      }\n\n    })\n\n\t}\n\n\texecute() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.callback = resolve\n      this.errorCallback = reject\n      document.getElementsByTagName('body')[0].appendChild(this.iframe)\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis._failed(new Error(\"Loading iframe timed out\"))\n\t\t\t}, this.timeout)\n\t\t})\n\t}\n\n\n\t_cleanup() {\n    let element = document.getElementById(this.id)\n    element.parentNode.removeChild(element)\n\t}\n\n  _failed(err) {\n    if (!this.isCompleted) {\n\t\t\tif (this.errorCallback && typeof this.errorCallback === 'function') {\n\t\t\t\tthis.errorCallback(err)\n\t\t\t}\n\t\t\tthis.isCompleted = true\n\t\t\tthis._cleanup()\n\t\t}\n  }\n\n\t_completed(response) {\n\t\tif (!this.isCompleted) {\n\t\t\tif (this.callback && typeof this.callback === 'function') {\n\t\t\t\tthis.callback(response)\n\t\t\t}\n\t\t\tthis.isCompleted = true\n\t\t\tthis._cleanup()\n\t\t}\n\t}\n}\n","import BasicLoader from './BasicLoader'\n\nexport default class Popup extends BasicLoader {\n\n\texecute() {\n\n\t\t/*\n\t\t* In the popup's scripts, running on <http://example.org>:\n\t\t*/\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\t// window.addEventListener(\"jso_message\", function(event) {\n\t\t\t// \tconsole.log(\"Sent a message to event.origin \" + event.origin + \" and got the following in response:\")\n\t\t\t// \tconsole.log(\"<em>\", event.data, \"</em>\")\n\t\t\t// \tvar url = newwindow.location.href\n\t\t\t// \t// console.error(\"Popup location is \", url, newwindow.location)\n\t\t\t//   resolve(url)\n\t\t\t// })\n\n\t\t\twindow.popupCompleted = function () {\n\t\t\t\tvar url = newwindow.location.href;\n\t\t\t\tresolve(url)\n\t\t\t}\n\n\t\t\tvar w = 400;\n\t\t\tvar h = 600;\n\t\t\tvar left = (screen.width/2)-(w/2);\n\t\t\tvar top = (screen.height/2)-(h/2);\n\n\t\t\tvar newwindow = window.open(this.url, 'jso-popup-auth', 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);\n\t\t\tif (newwindow === null) {\n\t\t\t\tthrow new Error(\"Error loading popup window\");\n\t\t\t}\n\n\t\t\tif (window.focus) {\n\t\t\t\tnewwindow.focus();\n\t\t\t}\n\n\t\t})\n\t}\n}\n","\nexport default class Error {\n\tconstructor(props) {\n\t\tfor(var key in props) {\n\t\t\tthis[key] = props[key];\n\t\t}\n\t}\n\n\tset(key, value) {\n\t\tthis[key] = value;\n\t\treturn this;\n\t}\n}","import Error from './Error';\n\nexport default class ExpiredTokenError extends Error {\n\n}","import Error from './Error'\n\nexport default class OAuthResponseError extends Error {\n\n  toString() {\n    let header = this.error || 'unknown'\n    let descr = this.error_description ||Â 'unknown'\n    return 'OAuthResponseError: [' + header + ']: ' + descr\n  }\n}\n","import utils from './utils'\n\nclass Store {\n\n\tconstructor() {\n\t\t\n\t}\n\n\t/*\n\t\tsaveState stores an object with an Identifier.\n\t\tTODO: Ensure that both sessionStorage and JSON encoding has fallbacks for ancient browsers.\n\t\tIn the state object, we put the request object, plus these parameters:\n\t\t  * restoreHash\n\t\t  * connector_name\n\t\t  * scopes\n\n\t */\n\tsaveState(state, obj) {\t\t\n\t\tsessionStorage.setItem(\"state-\" + state, JSON.stringify(obj))\n\t}\n\n\t/**\n\t * getStage()  returns the state object, but also removes it.\n\t * @type {Object}\n\t */\n\tgetState(state) {\n\t\t// log(\"getState (\" + state+ \")\");\n\t\tvar obj = JSON.parse(sessionStorage.getItem(\"state-\" + state))\n\t\tsessionStorage.removeItem(\"state-\" + state)\n\t\treturn obj\n\t}\n\n\n\t/*\n\t * Checks if a token, has includes a specific scope.\n\t * If token has no scope at all, false is returned.\n\t */\n\thasScope(token, scope) {\n\t\tvar i\n\t\tif (!token.scopes) return false\n\t\tfor(i = 0; i < token.scopes.length; i++) {\n\t\t\tif (token.scopes[i] === scope) return true\n\t\t}\n\t\treturn false\n\t}\n\n\t/*\n\t * Takes an array of tokens, and removes the ones that\n\t * are expired, and the ones that do not meet a scopes requirement.\n\t */\n\tfilterTokens(tokens, scopes) {\n\t\tvar i, j,\n\t\t\tresult = [],\n\t\t\tnow = utils.epoch(),\n\t\t\tusethis\n\n\t\tif (!scopes) scopes = []\n\n\t\tfor(i = 0; i < tokens.length; i++) {\n\t\t\tusethis = true\n\n\t\t\t// Filter out expired tokens. Tokens that is expired in 1 second from now.\n\t\t\tif (tokens[i].expires && tokens[i].expires < (now+1)) usethis = false\n\n\t\t\t// Filter out this token if not all scope requirements are met\n\t\t\tfor(j = 0; j < scopes.length; j++) {\n\t\t\t\tif (!this.hasScope(tokens[i], scopes[j])) usethis = false\n\t\t\t}\n\n\t\t\tif (usethis) result.push(tokens[i])\n\t\t}\n\t\treturn result\n\t}\n\n\n\t/*\n\t * saveTokens() stores a list of tokens for a provider.\n\n\t\tUsually the tokens stored are a plain Access token plus:\n\t\t  * expires : time that the token expires\n\t\t  * connector_name: the provider of the access token?\n\t\t  * scopes: an array with the scopes (not string)\n\t */\n\tsaveTokens(provider, tokens) {\n\t\t// log(\"Save Tokens (\" + provider+ \")\");\n\t\tsessionStorage.setItem(\"tokens-\" + provider, JSON.stringify(tokens))\n\t}\n\n\tgetTokens(provider) {\n\t\t// log(\"Get Tokens (\" + provider+ \")\");\n\t\tvar tokens = JSON.parse(sessionStorage.getItem(\"tokens-\" + provider));\n\t\tif (!tokens) tokens = [];\n\n\t\tutils.log(\"Token found when loooking up provider \" + provider + \" in store \" + window.location.href, tokens);\n\t\treturn tokens;\n\t}\n\n\twipeTokens(provider) {\n\t\tsessionStorage.removeItem(\"tokens-\" + provider)\n\t}\n\n\t/*\n\t * Save a single token for a provider.\n\t * This also cleans up expired tokens for the same provider.\n\t */\n\tsaveToken(provider, token) {\n\t\tvar tokens = this.getTokens(provider)\n\t\ttokens = this.filterTokens(tokens)\n\t\ttokens.push(token)\n\t\tthis.saveTokens(provider, tokens)\n\t}\n\n\t/*\n\t * Get a token if exists for a provider with a set of scopes.\n\t * The scopes parameter is OPTIONAL.\n\t */\n\tgetToken(provider, scopes) {\n\t\tvar tokens = this.getTokens(provider)\n\t\ttokens = this.filterTokens(tokens, scopes)\n\t\tif (tokens.length < 1) return null\n\t\treturn tokens[0]\n\t};\n\n}\n\nvar s = new Store()\n\nexport default s\n","let utils = {}\n\n/*\n * Returns epoch, seconds since 1970.\n * Used for calculation of expire times.\n */\nutils.epoch = function () {\n\treturn Math.round(new Date().getTime() / 1000.0)\n}\n\nutils.debug = false\n\n/*\n * Returns a random string used for state\n */\nutils.uuid = function () {\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n\t\tvar r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8)\n\t\treturn v.toString(16)\n\t})\n}\n\n/*\n * Takes a full url as input and expect it to have an encoded response\n * object as eigther a query string or an encoded fragment.\n * Returns the decoded object, or throws an error if no query string or fragment.\n */\nutils.getResponseFromURL = function (url) {\n\tif (url.indexOf('#') !== -1) {\n\t\treturn utils.parseQueryString(url.substring(url.indexOf('#') + 1))\n\t} else if (url.indexOf('?') !== -1) {\n\t\treturn utils.parseQueryString(url.substring(url.indexOf('?') + 1))\n\t}\n\treturn {}\n}\n\nutils.parseQueryString = function (qs) {\n\tvar e,\n\t\ta = /\\+/g,  // Regex for replacing addition symbol with a space\n\t\tr = /([^&;=]+)=?([^&;]*)/g,\n\t\td = function (s) { return decodeURIComponent(s.replace(a, \" \")) },\n\t\tq = qs,\n\t\turlParams = {}\n\n\t/* jshint ignore:start */\n\twhile (e = r.exec(q)) {\n\t\turlParams[d(e[1])] = d(e[2])\n\t};\n\t/* jshint ignore:end */\n\n\treturn urlParams\n}\n\n\n\n\n\n/**\n * Utility: scopeList(scopes )\n * Takes a list of scopes that might be overlapping, and removed duplicates,\n * then concatenates the list by spaces and returns a string.\n *\n * @param  {[type]} scopes [description]\n * @return {[type]}        [description]\n */\nutils.scopeList = function (scopes) {\n\treturn utils.uniqueList(scopes).join(' ')\n}\n\n\nutils.uniqueList = function (items) {\n\tvar uniqueItems = {}\n\tvar resultItems = []\n\tfor (var i = 0; i < items.length; i++) {\n\t\tuniqueItems[items[i]] = 1\n\t}\n\tfor (var key in uniqueItems) {\n\t\tif (uniqueItems.hasOwnProperty(key)) {\n\t\t\tresultItems.push(key)\n\t\t}\n\t}\n\treturn resultItems\n}\n\n\n\n/**\n * A log wrapper, that only logs if logging is turned on in the config\n * @param  {string} msg Log message\n */\nutils.log = function (msg) {\n\tif (!console) return\n\tif (!console.log) return\n\tif (!utils.debug) return\n\n\tlet args = Array.prototype.slice.call(arguments)\n\targs.unshift('[JSO]')\n\tconsole.log.apply(console, args)\n\n}\n\nutils.encodeQS = function (params) {\n\tlet res = ''\n\tvar k, i = 0\n\tfor (k in params) {\n\t\tres += (i++ === 0 ? '' : '&') + encodeURIComponent(k) + '=' + encodeURIComponent(params[k])\n\t}\n\treturn res\n}\n\n/*\n * Takes an URL as input and a params object.\n * Each property in the params is added to the url as query string parameters\n */\nutils.encodeURL = function (url, params) {\n\tvar res = url\n\tvar k, i = 0\n\tvar firstSeparator = (url.indexOf(\"?\") === -1) ? '?' : '&'\n\tfor (k in params) {\n\t\tres += (i++ === 0 ? firstSeparator : '&') + encodeURIComponent(k) + '=' + encodeURIComponent(params[k])\n\t}\n\treturn res\n}\n\n\nutils.sha256Hash = function (str) {\n\treturn window.crypto.subtle.digest(\"SHA-256\", new TextEncoder().encode(str));\n}\n\n// Base64 encode\nutils.encode64 = function (buff) {\n\treturn btoa(new Uint8Array(buff).reduce((s, b) => s + String.fromCharCode(b), ''));\n}\n\n/* \n * Base64 url safe encoding of an array\n */\nutils.base64UrlSafeEncode = function (buf) {\n\tconst s = utils.encode64(buf).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"\")\n\treturn s\n}\n\n\n/* Calc code verifier if necessary\n */\nutils.getCodeChallenge = function (code_verifier) {\n\treturn utils.sha256Hash(code_verifier).then(\n\t\t(hashed) => {\n\t\t\treturn utils.base64UrlSafeEncode(hashed)\n\t\t}\n\t).catch(\n\t\t(error) => { utils.log(error) }\n\t).finally(\n\t\t() => { return null }\n\t)\n}\n\nexport default utils\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * JSO - Javascript OAuth Library\n * \tVersion 4.0\n *  UNINETT AS - http://uninett.no\n *  Author: Andreas Ãkre Solberg <andreas.solberg@uninett.no>\n *  Licence: Simplified BSD Licence\n *\n *  Documentation available at: https://github.com/andreassolberg/jso\n */\n\n\nimport store from './store-session'\nimport utils from './utils'\n\n// Work in progress\n// import Authentication from './Authentication/Authentication'\n\nimport BasicLoader from './Loaders/BasicLoader'\nimport HTTPRedirect from './Loaders/HTTPRedirect'\nimport IFramePassive from './Loaders/IFramePassive'\nimport IFrameActive from './Loaders/IFrameActive'\nimport Popup from './Loaders/Popup'\n\nimport Fetcher from './HTTP/Fetcher'\nimport FetcherJQuery from './HTTP/FetcherJQuery'\n\n// import ExpiredTokenError from './errors/ExpiredTokenError'\n// import HTTPError from './errors/HTTPError'\nimport OAuthResponseError from './errors/OAuthResponseError'\n\nimport Config from './Config'\nimport EventEmitter from './EventEmitter'\n\nconst package_json = require('../package.json')\n\nconst default_config = {\n\tlifetime: 3600,\n\tresponse_type: 'token',\n}\n\nclass JSO extends EventEmitter {\n\n\tconstructor(config) {\n\t\tsuper();\n\t\tthis.configure(config);\n\t\tthis.connector_name = this.getconnector_name();\n\t\tthis.Loader = Popup; // HTTPRedirect;\n\t\tthis.store = store;\n\t\tthis.callbacks = {};\n\n\t\tif (this.config.getValue('debug', false)) {\n\t\t\tutils.debug = true;\n\t\t}\n\t}\n\n\tconfigure(config) {\n\t\tthis.config = new Config(default_config, config);\n\t}\n\n\t// Experimental, nothing but default store exists yet. Not documented.\n\tsetStore(newstore) {\n\t\tthis.store = newstore\n\t}\n\n\tsetLoader(loader) {\n\t\tif (typeof loader === \"function\") {\n\t\t\tthis.Loader = loader\n\t\t} else {\n\t\t\tthrow new Error(\"loader MUST be an instance of the JSO BasicLoader\")\n\t\t}\n\t}\n\n\n\n\t/**\n\t * We need to get an identifier to represent this OAuth provider.\n\t * The JSO construction option connector_name is preferred, if not provided\n\t * we construct a concatentaion of authorization url and client_id.\n\t * @return {[type]} [description]\n\t */\n\tgetconnector_name() {\n\n\t\tvar c = this.config.getValue('connector_name', null)\n\t\tif (c !== null) { return c }\n\n\t\tvar client_id = this.config.getValue('client_id', null, true)\n\t\tvar authorization = this.config.getValue('authorization', null, true)\n\n\t\treturn authorization + '|' + client_id\n\t}\n\n\t/**\n\t * If the callback has already successfully parsed a token response, call this.\n\t * @return {[type]} [description]\n\t */\n\tprocessTokenResponse(atoken) {\n\t\tlet state\n\t\tif (atoken.state) {\n\t\t\tstate = this.store.getState(atoken.state)\n\t\t} else {\n\t\t\tthrow new Error(\"Could not get state from storage.\")\n\t\t}\n\n\t\tif (!state) {\n\t\t\tthrow new Error(\"Could not retrieve state\")\n\t\t}\n\t\tif (!state.connector_name) {\n\t\t\tthrow new Error(\"Could not get connector_name from state\")\n\t\t}\n\t\tutils.log(\"processTokenResponse \", atoken, \"\")\n\t\treturn this.processReceivedToken(atoken, state)\n\t}\n\n\tprocessReceivedToken(atoken, state) {\n\t\t/*\n\t\t\t * Decide when this token should expire.\n\t\t\t * Priority fallback:\n\t\t\t * 1. Access token expires_in\n\t\t\t * 2. Life time in config (may be false = permanent...)\n\t\t\t * 3. Specific permanent scope.\n\t\t\t * 4. Default library lifetime:\n\t\t\t */\n\t\tlet now = utils.epoch()\n\t\tatoken.received = now\n\t\tif (atoken.expires_in) {\n\t\t\tatoken.expires = now + parseInt(atoken.expires_in, 10)\n\t\t\tatoken.expires_in = parseInt(atoken.expires_in, 10)\n\t\t} else if (this.config.getValue('default_lifetime', null) === false) {\n\t\t\tatoken.expires = null\n\t\t} else if (this.config.has('permanent_scope')) {\n\t\t\tif (!this.store.hasScope(atoken, this.config.getValue('permanent_scope'))) {\n\t\t\t\tatoken.expires = null\n\t\t\t}\n\t\t} else if (this.config.has('default_lifetime')) {\n\t\t\tatoken.expires = now + this.config.getValue('default_lifetime')\n\t\t} else {\n\t\t\tatoken.expires = now + 3600\n\t\t}\n\n\t\t/*\n\t\t * Handle scopes for this token\n\t\t */\n\t\tif (atoken.scope) {\n\t\t\tatoken.scopes = atoken.scope.split(\" \");\n\t\t\tdelete atoken.scope;\n\t\t} else if (state.scopes) {\n\t\t\tatoken.scopes = state.scopes;\n\t\t} else {\n\t\t\tatoken.scopes = []\n\t\t}\n\n\t\tutils.log(\"processTokenResponse completed \", atoken, \"\");\n\n\t\tthis.store.saveToken(state.connector_name, atoken);\n\n\t\t// create non bubbling named-signal event\n\t\tvar signal = new CustomEvent(\"signal-token-received\", {\n\t\t\tbubbles: false,\n\t\t\tdetail: atoken\n\t\t});\n\n\t\tdocument.dispatchEvent(signal);\n\n\t\treturn atoken;\n\t}\n\n\n\tprocessAuthorizationCodeResponse(object) {\n\n\t\t// this.emit('authorizationCode', object)\n\n\t\tlet state;\n\t\tif (object.state) {\n\t\t\tstate = this.store.getState(object.state)\n\t\t\tif (state === null) {\n\t\t\t\tthrow new Error(\"Could not find retrieve state object.\")\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new Error(\"Could not find state paramter from callback.\")\n\t\t}\n\n\t\tconsole.log(\"state\", state);\n\n\t\tif (!this.config.has('token')) {\n\t\t\tutils.log(\"Received an authorization code. Will not process it as the config option [token] endpoint is not set. If you would like to process the code yourself, please subscribe to the [authorizationCode] event\")\n\t\t\treturn\n\t\t}\n\n\t\tlet headers = new Headers();\n\t\theaders.append('Content-Type', 'application/x-www-form-urlencoded;charset=UTF-8')\n\n\t\tlet tokenRequest = {\n\t\t\t'grant_type': 'authorization_code',\n\t\t\t'client_id': this.config.getValue('client_id'),\n\t\t\t'code': object.code\n\t\t}\n\n\t\tif (this.config.getValue('use_pkce', false)) {\n\t\t\t// Also include the original created code_verifier\n\t\t\ttokenRequest.code_verifier = state.code_verifier\n\t\t}\n\n\t\tif (state.hasOwnProperty('redirect_uri')) {\n\t\t\ttokenRequest.redirect_uri = state.redirect_uri\n\t\t}\n\n\t\tlet opts = {\n\t\t\tmode: 'cors',\n\t\t\theaders: headers,\n\t\t\tmethod: 'POST', // or 'PUT'\n\t\t\tbody: utils.encodeQS(tokenRequest), // data can be `string` or {object}!\n\t\t}\n\n\t\treturn fetch(this.config.getValue('token'), opts)\n\t\t\t.then((httpResponse) => {\n\t\t\t\treturn httpResponse.json();\n\t\t\t})\n\t\t\t.then((tokenResponse) => {\n\t\t\t\tutils.log(\"Received response on token endpoint \", tokenResponse, \"\");\n\t\t\t\treturn this.processReceivedToken(tokenResponse, state);\n\t\t\t})\n\n\t\t// throw new Exception(\"Implementation of authorization code flow is not yet implemented. Instead use the implicit grant flow\")\n\n\t}\n\n\n\n\tprocessErrorResponse(err) {\n\n\t\tvar state\n\t\tif (err.state) {\n\n\t\t\tstate = this.store.getState(err.state)\n\t\t} else {\n\t\t\tthrow new Error(\"Could not get [state] and no default connector_name is provided.\")\n\t\t}\n\n\t\tif (!state) {\n\t\t\tthrow new Error(\"Could not retrieve state\")\n\t\t}\n\t\tif (!state.connector_name) {\n\t\t\tthrow new Error(\"Could not get connector_name from state\")\n\t\t}\n\n\t\tif (state.restoreHash) {\n\t\t\twindow.location.hash = state.restoreHash\n\t\t} else {\n\t\t\twindow.location.hash = ''\n\t\t}\n\t\treturn new OAuthResponseError(err)\n\n\t}\n\n\n\t/**\n\t * Check if the hash contains an access token.\n\t * And if it do, extract the state, compare with\n\t * config, and store the access token for later use.\n\t *\n\t * The url parameter is optional. Used with phonegap and\n\t * childbrowser when the jso context is not receiving the response,\n\t * instead the response is received on a child browser.\n\t */\n\tcallback(data) {\n\n\t\tdebugger;\n\n\t\tlet response = null\n\t\tif (typeof data === 'object') {\n\t\t\tresponse = data\n\t\t} else if (typeof data === 'string') {\n\t\t\tresponse = utils.getResponseFromURL(data)\n\t\t} else if (typeof data === 'undefined') {\n\t\t\tresponse = utils.getResponseFromURL(window.location.href)\n\t\t} else {\n\t\t\t// no response provided.\n\t\t\treturn\n\t\t}\n\n\t\tutils.log('Receving response in callback', response)\n\n\t\tif (response.hasOwnProperty(\"access_token\")) {\n\n\t\t\treturn this.processTokenResponse(response);\n\n\t\t} else if (response.hasOwnProperty(\"code\")) {\n\n\t\t\treturn this.processAuthorizationCodeResponse(response);\n\n\t\t} else if (response.hasOwnProperty(\"error\")) {\n\n\t\t\tthrow this.processErrorResponse(response);\n\n\t\t}\n\t}\n\n\n\tdump() {\n\t\tvar tokens = this.store.getTokens(this.connector_name)\n\t\tvar x = {\n\t\t\t\"connector_name\": this.connector_name,\n\t\t\t\"tokens\": tokens,\n\t\t\t\"config\": this.config\n\t\t}\n\t\treturn x\n\t}\n\n\t_getRequestScopes(opts) {\n\t\tvar scopes = [], i\n\t\t/*\n\t\t * Calculate which scopes to request, based upon provider config and request config.\n\t\t */\n\t\tif (this.config.has('scopes.request')) {\n\t\t\tlet s = this.config.getValue('scopes.request')\n\t\t\tfor (i = 0; i < s.length; i++) {\n\t\t\t\tscopes.push(s[i])\n\t\t\t}\n\t\t}\n\t\tif (opts && opts.scopes && opts.scopes.request) {\n\t\t\tfor (i = 0; i < opts.scopes.request.length; i++) { scopes.push(opts.scopes.request[i]) }\n\t\t}\n\t\treturn utils.uniqueList(scopes)\n\t}\n\n\t_getRequiredScopes(opts) {\n\t\tvar scopes = [], i\n\t\t/*\n\t\t * Calculate which scopes to request, based upon provider config and request config.\n\t\t */\n\t\tif (this.config.has('scopes.require')) {\n\t\t\tlet s = this.config.getValue('scopes.require')\n\t\t\tfor (i = 0; i < s.length; i++) {\n\t\t\t\tscopes.push(s[i])\n\t\t\t}\n\t\t}\n\t\tif (opts && opts.scopes && opts.scopes.require) {\n\t\t\tfor (i = 0; i < opts.scopes.require.length; i++) { scopes.push(opts.scopes.require[i]) }\n\t\t}\n\t\treturn utils.uniqueList(scopes)\n\t}\n\n\tgetToken(opts) {\n\t\treturn this.store.getToken(this.connector_name, this.config.config.scopes);\n\t}\n\n\t/*\n\t * 2nd portion of authorize method.  Was put into its own method to cope with an optional async path that happens when\n\t *  use_pkce is specified\n\t */\n\t_authorize2(request, code_verifier, scopes) {\n\n\t\tlet authorization = this.config.getValue('authorization', null, true)\n\n\t\tutils.log(\"Debug Authentication request object\", JSON.stringify(request, undefined, 2))\n\n\t\tvar authurl = utils.encodeURL(authorization, request)\n\n\t\t// After authurl has been established, some other state is stored within the request object which is persisted\n\t\t// Keep generated code_verifier around as we need to send it with the code challenge to retrieve token\n\t\tlet bUsePKCE = this.config.getValue('use_pkce', false);\n\t\tif (bUsePKCE) {\n\t\t\trequest.code_verifier = code_verifier;\n\t\t}\n\n\t\t// We'd like to cache the hash for not loosing Application state.\n\t\t// With the implciit grant flow, the hash will be replaced with the access\n\t\t// token when we return after authorization.\n\t\tif (window.location.hash) {\n\t\t\trequest.restoreHash = window.location.hash;\n\t\t}\n\t\trequest.connector_name = this.connector_name;\n\n\t\t// If there were specific scopes established, save within state\n\t\tif (scopes) {\n\t\t\trequest.scopes = scopes;\n\t\t}\n\n\t\tutils.log(\"Saving state [\" + request.state + \"]\");\n\t\tutils.log(JSON.parse(JSON.stringify(request)));\n\n\t\tvar loader = this.Loader;\n\n\t\tthis.store.saveState(request.state, request)\n\t\treturn this.gotoAuthorizeURL(authurl, loader)\n\t\t\t.then((response) => {\n\t\t\t\tdebugger; // when is that reached ??\n\t\t\t\tif (response !== true) {\n\t\t\t\t\treturn this.callback(response)\n\t\t\t\t}\n\t\t\t})\n\n\t}\n\n\t/**\n\t * Send authorization request.\n\t *\n\t * @param  {[type]} opts These options matches the ones sent in the \"oauth\" property of the ajax settings in the request.\n\t * @return {[type]}      [description]\n\t */\n\tauthorize() {\n\t\tvar request, scopes;\n\n\t\tlet authorization = this.config.getValue('authorization', null, true);\n\t\tlet client_id = this.config.getValue('client_id', null, true);\n\t\tlet use_pkce = this.config.getValue('use_pkce', false);\n\t\tlet openid = false;\n\n\t\tutils.log(\"About to send an authorization request to this endpoint\", authorization);\n\n\t\trequest = {};\n\t\trequest.state = utils.uuid();\n\t\trequest.response_type = this.config.getValue('response_type', 'id_token token');\n\t\tif (use_pkce) request.response_type = 'code';\n\n\t\tif (this.config.has('redirect_uri')) {\n\t\t\trequest.redirect_uri = this.config.getValue('redirect_uri', '');\n\t\t}\n\n\t\trequest.client_id = client_id;\n\n\t\t/*\n\t\t * Calculate which scopes to request, based upon provider config and request config.\n\t\t */\n\t\tscopes = this.config.config.scopes;\n\t\topenid = scopes.includes('openid');\n\t\tif (scopes.length > 0) {\n\t\t\trequest.scope = utils.scopeList(scopes);\n\t\t}\n\n\t\tutils.log(\"Running in mode: \" + (openid ? 'OpenID Connect mode' : 'OAuth mode'))\n\n\t\tif (openid && !request.hasOwnProperty('redirect_uri')) {\n\t\t\tthrow new Error('An OpenID Request requires a redirect_uri to be set. Please add to configuration. A redirect_uri is not required for plain OAuth')\n\t\t}\n\n\t\tif (openid) {\n\t\t\trequest.nonce = utils.uuid()\n\t\t}\n\n\t\t// If pkce is being utilized, create random code_verifier and create challenge\n\t\tlet cv = null;\n\t\tif (use_pkce) {\n\t\t\tif (!window.crypto) {\n\t\t\t\tthrow new Error('Browser crypto APIs are not available')\n\t\t\t}\n\n\t\t\t// RFC 7636 says the random string should be between 43 and 128 chars\n\t\t\t// Use 64 char buf for now\n\t\t\tvar buf = new Uint8Array(64)\n\t\t\twindow.crypto.getRandomValues(buf)\n\t\t\tcv = utils.base64UrlSafeEncode(buf)\n\n\t\t\tutils.getCodeChallenge(cv).then(cc => {\n\t\t\t\trequest.code_challenge = cc\n\t\t\t\t//Generate string sequence\n\t\t\t\trequest.code_challenge_method = \"S256\"\n\n\t\t\t\treturn this._authorize2(request, cv, scopes);\n\t\t\t});\n\n\t\t} else {\n\t\t\treturn this._authorize2(request, cv, scopes);\n\t\t}\n\t}\n\n\tgotoAuthorizeURL(url, Loader) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tif (Loader !== null && typeof Loader === 'function') {\n\t\t\t\tvar loader = new Loader(url)\n\t\t\t\tif (!(loader instanceof BasicLoader)) {\n\t\t\t\t\tthrow new Error(\"JSO selected Loader is not an instance of BasicLoader.\")\n\t\t\t\t}\n\t\t\t\tresolve(loader.execute())\n\t\t\t} else {\n\t\t\t\treject(new Error('Cannot redirect to authorization endpoint because of missing redirect handler'))\n\t\t\t}\n\t\t})\n\t}\n\n\twipeTokens() {\n\t\tthis.store.wipeTokens(this.connector_name)\n\t}\n\n}\n\n// Object.assign(JSO.prototype, new EventEmitter({}))\n\nexport { JSO, BasicLoader, HTTPRedirect, Popup, IFramePassive, IFrameActive, Fetcher, FetcherJQuery }\n// Work in progress\n// Authentication\n"],"sourceRoot":""}